<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Tutorial for connecting Redis to Kafka with Kafka Connect Redis">
<link rel=canonical href=https://jaredpetersen.github.io/blog/2020/11/kafka-connect-redis-intro/>
<link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>%f0%9f%9a%9c</text></svg>">
<link rel=stylesheet href=/sass/style.min.1366015b75782e3d0b99a1382faba8be527df73ceb6a3f1350c54e9e16551ae4.css>
<title>Sinking and Sourcing Redis Data With Kafka Connect Redis | Jared Petersen</title>
<meta property="og:title" content="Sinking and Sourcing Redis Data With Kafka Connect Redis">
<meta property="og:description" content="Tutorial for connecting Redis to Kafka with Kafka Connect Redis">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jaredpetersen.github.io/blog/2020/11/kafka-connect-redis-intro/"><meta property="og:image" content="https://jaredpetersen.github.io/img/kafka-connect-redis-intro/repository-screenshot.png"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2020-11-11T00:00:00-07:00">
<meta property="article:modified_time" content="2020-11-11T00:00:00-07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://jaredpetersen.github.io/img/kafka-connect-redis-intro/repository-screenshot.png">
<meta name=twitter:title content="Sinking and Sourcing Redis Data With Kafka Connect Redis">
<meta name=twitter:description content="Tutorial for connecting Redis to Kafka with Kafka Connect Redis">
</head>
<body>
<nav class=navbar>
<div class=brand><a href=/ rel=noreferrer title=Home aria-label=Home>Jared Petersen</a></div>
<div class=social>
<a href=/blog rel=noreferrer title=Blog aria-label=Blog><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M288 248v28c0 6.6-5.4 12-12 12H108c-6.6.0-12-5.4-12-12v-28c0-6.6 5.4-12 12-12h168c6.6.0 12 5.4 12 12zm-12 72H108c-6.6.0-12 5.4-12 12v28c0 6.6 5.4 12 12 12h168c6.6.0 12-5.4 12-12v-28c0-6.6-5.4-12-12-12zm108-188.1V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V48C0 21.5 21.5.0 48 0h204.1C264.8.0 277 5.1 286 14.1L369.9 98c9 8.9 14.1 21.2 14.1 33.9zm-128-80V128h76.1L256 51.9zM336 464V176H232c-13.3.0-24-10.7-24-24V48H48v416h288z"/></svg>
</a>
<a href=https://github.com/jaredpetersen target=_blank rel=noreferrer title=GitHub aria-label=GitHub><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8.0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8.0-21.5 4.9-32.3 14.6-51.8 45.3.0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8.0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9.0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2.0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8.0-73.5 38.7-73.5 82.6.0 87.8 80.4 101.3 150.4 101.3h48.2c70.3.0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8.0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
</a>
<a href=https://stackoverflow.com/users/7583677/jared-petersen target=_blank rel=noreferrer title=StackOverflow aria-label=StackOverflow><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg>
</a>
<a href=https://www.linkedin.com/in/petersenjared target=_blank rel=noreferrer title=LinkedIn aria-label=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</a>
<a href=https://instagram.com/jaredtpetersen target=_blank rel=noreferrer title=Instagram aria-label=Instagram><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6.0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1.0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9.0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9.0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9.0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9.0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8.0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
</a>
<a href=https://twitter.com/jaredtpetersen target=_blank rel=noreferrer title=Twitter aria-label=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</a>
<a href=mailto:jaredtoddpetersen@gmail.com target=_blank rel=noreferrer title=Email aria-label=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 64H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 4e2V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V4e2H48z"/></svg>
</a>
</div>
</nav>
<main>
<h1>Sinking and Sourcing Redis Data With Kafka Connect Redis</h1>
<h5>Nov 11, 2020 | 7 min read</h5>
<section class=single>
<p>
<img src=/img/kafka-connect-redis-intro/repository-screenshot.png alt="Screenshot of the Kafka Connect Redis repository">
</p>
<p><a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
is a new open source, MIT-licensed Kafka Connect plugin that can integrate Redis into your Kafka data pipelines.</p>
<p>Need data from Redis streamed to another application in realtime via Kafka? You’re covered with the source connector, enabling you to create records based on <a href=https://redis.io/topics/pubsub target=_blank>pub/sub messages</a>
or <a href=https://redis.io/topics/notifications target=_blank>keyspace notifications</a>
.</p>
<p>Need to write some data into Redis via Kafka messages? Great! Just use the sink connector and produce messages that describe the write operation you’d like to perform (<code>SET</code>, <code>SADD</code>, etc.).</p>
<p>I&rsquo;ve put together a nifty demonstration to show off the connector’s capabilities. All you need is minikube so that we can set up the Redis and the various Kafka components without installing them directly on your computer.</p>
<p>Let’s get started!</p>
<h2 id=basic-setup>Basic Setup</h2>
<p>As mentioned earlier, we’re going to use minkube to help us run all of the different components in Kubernetes.</p>
<p>Once you have that installed, set it up:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>minikube start --cpus <span class=m>2</span> --memory 10g
</code></pre></div><p>Nice! Nothing’s running in it so far so let’s fix that. Download the <a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
repository and navigate to docs/demo/docker/ in your terminal. From here, we’re going to build a Docker image that contains our Kafka connector.</p>
<p>First, download the latest version of Kafka Connect Redis. At the moment, that’s version 1.0.1:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>curl -O https://oss.sonatype.org/service/local/repositories/releases/content/io/github/jaredpetersen/kafka-connect-redis/1.0.1/kafka-connect-redis-1.0.1.jar
</code></pre></div><p>Next, we’ll want to set up our terminal environment so that we can build a Docker image that can be used inside minikube:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span><span class=nb>eval</span> <span class=k>$(</span>minikube docker-env<span class=k>)</span>
</code></pre></div><p>Then build the image:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>docker build -t jaredpetersen/kafka-connect-redis:latest .
</code></pre></div><p>Now that we have a Docker image for the connector inside our minikube instance, close out this terminal. The previous <code>eval</code> command pollutes your terminal environment with minikube-specific configuration and we don’t want that to affect any future commands.</p>
<p>Open up a new terminal and navigate back to docs/demo in the downloaded Kafka Connect Redis repository. Now we can start installing all those awesome Kafka and Redis components.</p>
<p>Run the following command to apply the Kubernetes manifests:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl apply -k kubernetes
</code></pre></div><p>Monitor the rollout progress. This can take a few minutes, so be patient!</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl -n kcr-demo get pods
</code></pre></div><p>Once all the pods are up and ready to go, we need to do one last thing to configure the applications running in Kubernetes; we need to tell Redis to run as a cluster. To accomplish that, we’re just going to create a temporary pod that runs a redis-cli command:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl -n kcr-demo run -it --rm redis-client --image redis:6 -- redis-cli --pass IEPfIr0eLF7UsfwrIlzy80yUaBG258j9 --cluster create <span class=k>$(</span>kubectl -n kcr-demo get pods -l <span class=nv>app</span><span class=o>=</span>redis-cluster -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range.items[*]}{.status.podIP}:6379 &#39;</span><span class=k>)</span> --cluster-yes
</code></pre></div><p>You’re well on your way to trying out the connector! It’s a bit of setup for sure but it’s well worth the effort.</p>
<h2 id=sink-connector>Sink Connector</h2>
<p>Let’s start sinking data from Kafka into Redis!</p>
<p>Unlike other Redis sink connectors, <a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
supports more than just Redis <code>SET</code> commands. Several different commands are supported at this time (<code>SET</code>, <code>SADD</code>, <code>GEOADD</code>, etc.) — check out the repository for the full list.</p>
<p>The first thing we need to do is make a POST request against the Kafka Connect REST API running in minikube to tell it to create a new instance of the Redis connector. In this demonstration, we’re going to be using Connect JSON as the Kafka record serialization format to make it a little easier to use. Avro is supported as well and the steps to use Avro instead are documented in the repository.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln> 1</span>curl --request POST <span class=se>\
</span><span class=ln> 2</span><span class=se></span>    --url <span class=s2>&#34;</span><span class=k>$(</span>minikube -n kcr-demo service kafka-connect --url<span class=k>)</span><span class=s2>/connectors&#34;</span> <span class=se>\
</span><span class=ln> 3</span><span class=se></span>    --header <span class=s1>&#39;content-type: application/json&#39;</span> <span class=se>\
</span><span class=ln> 4</span><span class=se></span>    --data <span class=s1>&#39;{
</span><span class=ln> 5</span><span class=s1>        &#34;name&#34;: &#34;demo-redis-sink-connector&#34;,
</span><span class=ln> 6</span><span class=s1>        &#34;config&#34;: {
</span><span class=ln> 7</span><span class=s1>            &#34;connector.class&#34;: &#34;io.github.jaredpetersen.kafkaconnectredis.sink.RedisSinkConnector&#34;,
</span><span class=ln> 8</span><span class=s1>            &#34;key.converter&#34;: &#34;org.apache.kafka.connect.json.JsonConverter&#34;,
</span><span class=ln> 9</span><span class=s1>            &#34;value.converter&#34;: &#34;org.apache.kafka.connect.json.JsonConverter&#34;,
</span><span class=ln>10</span><span class=s1>            &#34;tasks.max&#34;: &#34;1&#34;,
</span><span class=ln>11</span><span class=s1>            &#34;topics&#34;: &#34;redis.commands&#34;,
</span><span class=ln>12</span><span class=s1>            &#34;redis.uri&#34;: &#34;redis://IEPfIr0eLF7UsfwrIlzy80yUaBG258j9@redis-cluster&#34;,
</span><span class=ln>13</span><span class=s1>            &#34;redis.cluster.enabled&#34;: true
</span><span class=ln>14</span><span class=s1>        }
</span><span class=ln>15</span><span class=s1>    }&#39;</span>
</code></pre></div><p>Now that our connector is up and running, we can write some records to Kafka and watch the data appear in Redis!</p>
<p>Set up an interactive, ephemeral Kubernetes Pod with the Kafka command line tools already installed:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl -n kcr-demo run -it --rm kafka-write-records --image confluentinc/cp-kafka:6.0.0 --command /bin/bash
</code></pre></div><p>Start up the console producer and configure it to write records to the <code>redis.commands</code> topic:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kafka-console-producer <span class=se>\
</span><span class=ln>2</span><span class=se></span>    --broker-list kafka-broker-0.kafka-broker:9092 <span class=se>\
</span><span class=ln>3</span><span class=se></span>    --topic redis.commands
</code></pre></div><p>This will bring up an interactive command-line application that allows you to write records to Kafka. Each newline represents a new record. Since we’re using the Connect JSON format, we need to include our schema and the actual data (called the payload) in one JSON object.</p>
<p>Write the following records:</p>
<p><strong>Redis SET command</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln>1</span>{&#34;payload&#34;:{&#34;key&#34;:&#34;{user.1}.username&#34;,&#34;value&#34;:&#34;jetpackmelon22&#34;},&#34;schema&#34;:{&#34;name&#34;:&#34;io.github.jaredpetersen.kafkaconnectredis.RedisSetCommand&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;key&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;value&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;expiration&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;type&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;time&#34;,&#34;type&#34;:&#34;int64&#34;,&#34;optional&#34;:true}],&#34;optional&#34;:true},{&#34;field&#34;:&#34;condition&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:true}]}}
</code></pre></div><p><strong>Redis SET command with expiration and an insert condition</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln>1</span>{&#34;payload&#34;:{&#34;key&#34;:&#34;{user.2}.username&#34;,&#34;value&#34;:&#34;anchorgoat74&#34;,&#34;expiration&#34;:{&#34;type&#34;:&#34;EX&#34;,&#34;time&#34;:2100},&#34;condition&#34;:&#34;NX&#34;},&#34;schema&#34;:{&#34;name&#34;:&#34;io.github.jaredpetersen.kafkaconnectredis.RedisSetCommand&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;key&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;value&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;expiration&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;type&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;time&#34;,&#34;type&#34;:&#34;int64&#34;,&#34;optional&#34;:true}],&#34;optional&#34;:true},{&#34;field&#34;:&#34;condition&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:true}]}}
</code></pre></div><p><strong>Redis SADD command</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln>1</span>{&#34;payload&#34;:{&#34;key&#34;:&#34;{user.1}.interests&#34;,&#34;values&#34;:[&#34;reading&#34;]},&#34;schema&#34;:{&#34;name&#34;:&#34;io.github.jaredpetersen.kafkaconnectredis.RedisSaddCommand&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;key&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;values&#34;,&#34;type&#34;:&#34;array&#34;,&#34;items&#34;:{&#34;type&#34;:&#34;string&#34;},&#34;optional&#34;:false}]}}
</code></pre></div><p><strong>Redis SADD command with multiple members</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln>1</span>{&#34;payload&#34;:{&#34;key&#34;:&#34;{user.2}.interests&#34;,&#34;values&#34;:[&#34;sailing&#34;,&#34;woodworking&#34;,&#34;programming&#34;]},&#34;schema&#34;:{&#34;name&#34;:&#34;io.github.jaredpetersen.kafkaconnectredis.RedisSaddCommand&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;key&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;values&#34;,&#34;type&#34;:&#34;array&#34;,&#34;items&#34;:{&#34;type&#34;:&#34;string&#34;},&#34;optional&#34;:false}]}}
</code></pre></div><p><strong>Redis GEOADD command with multiple members</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln>1</span>{&#34;payload&#34;:{&#34;key&#34;:&#34;Sicily&#34;,&#34;values&#34;:[{&#34;longitude&#34;:13.361389,&#34;latitude&#34;:13.361389,&#34;member&#34;:&#34;Palermo&#34;},{&#34;longitude&#34;:15.087269,&#34;latitude&#34;:37.502669,&#34;member&#34;:&#34;Catania&#34;}]},&#34;schema&#34;:{&#34;name&#34;:&#34;io.github.jaredpetersen.kafkaconnectredis.RedisGeoaddCommand&#34;,&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;key&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;values&#34;,&#34;type&#34;:&#34;array&#34;,&#34;items&#34;:{&#34;type&#34;:&#34;struct&#34;,&#34;fields&#34;:[{&#34;field&#34;:&#34;longitude&#34;,&#34;type&#34;:&#34;double&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;latitude&#34;,&#34;type&#34;:&#34;double&#34;,&#34;optional&#34;:false},{&#34;field&#34;:&#34;member&#34;,&#34;type&#34;:&#34;string&#34;,&#34;optional&#34;:false}]},&#34;optional&#34;:false}]}}
</code></pre></div><p>Okay, let’s get to the big payoff!</p>
<p>In a new terminal, run the following command to create an interactive, ephemeral Kubernetes pod with <code>redis-client</code> installed so that we can run commands against Redis and check our work.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl -n kcr-demo run -it --rm redis-client --image redis:6 -- /bin/bash
</code></pre></div><p>Use <code>redis-cli</code> in the pod to connect to the Redis cluster:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>redis-cli -c -u <span class=s1>&#39;redis://IEPfIr0eLF7UsfwrIlzy80yUaBG258j9@redis-cluster&#39;</span>
</code></pre></div><p>And run the following Redis commands to confirm that our connector worked:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln>1</span>GET {user.1}.username
<span class=ln>2</span>GET {user.2}.username
<span class=ln>3</span>SMEMBERS {user.1}.interests
<span class=ln>4</span>SMEMBERS {user.2}.interests
<span class=ln>5</span>GEOPOS Sicily Catania
</code></pre></div><p>Congratulations! You just successfully used <a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
to sink data into Redis via Kafka Connect!</p>
<h2 id=source-connector>Source Connector</h2>
<p>We can also use <a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
to subscribe to Redis pub/sub messages and produce Kafka records. This is super useful particularly when it comes to using <a href=https://redis.io/topics/notifications target=_blank>keyspace notifications</a>
, which use Redis’ pub/sub mechanism to communicate what’s going on inside Redis in realtime. Source functionality is unique to <a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
and is not supported by other connectors.</p>
<p>Let’s set up the source connector to subscribe to all the keyspace notifications that Redis has to offer and produce Kafka records.</p>
<p>Send a POST request to the Kafka Connect REST API to create a new source connector. We’re going to use Connect JSON here again for the sake of simplicity but Avro is also supported and the steps to use it are documented in the repository.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln> 1</span>curl --request POST <span class=se>\
</span><span class=ln> 2</span><span class=se></span>    --url <span class=s2>&#34;</span><span class=k>$(</span>minikube -n kcr-demo service kafka-connect --url<span class=k>)</span><span class=s2>/connectors&#34;</span> <span class=se>\
</span><span class=ln> 3</span><span class=se></span>    --header <span class=s1>&#39;content-type: application/json&#39;</span> <span class=se>\
</span><span class=ln> 4</span><span class=se></span>    --data <span class=s1>&#39;{
</span><span class=ln> 5</span><span class=s1>        &#34;name&#34;: &#34;demo-redis-source-connector&#34;,
</span><span class=ln> 6</span><span class=s1>        &#34;config&#34;: {
</span><span class=ln> 7</span><span class=s1>            &#34;connector.class&#34;: &#34;io.github.jaredpetersen.kafkaconnectredis.source.RedisSourceConnector&#34;,
</span><span class=ln> 8</span><span class=s1>            &#34;key.converter&#34;: &#34;org.apache.kafka.connect.json.JsonConverter&#34;,
</span><span class=ln> 9</span><span class=s1>            &#34;value.converter&#34;: &#34;org.apache.kafka.connect.json.JsonConverter&#34;,
</span><span class=ln>10</span><span class=s1>            &#34;tasks.max&#34;: &#34;1&#34;,
</span><span class=ln>11</span><span class=s1>            &#34;topic&#34;: &#34;redis.events&#34;,
</span><span class=ln>12</span><span class=s1>            &#34;redis.uri&#34;: &#34;redis://IEPfIr0eLF7UsfwrIlzy80yUaBG258j9@redis-cluster&#34;,
</span><span class=ln>13</span><span class=s1>            &#34;redis.cluster.enabled&#34;: true,
</span><span class=ln>14</span><span class=s1>            &#34;redis.channels&#34;: &#34;__key*__:*&#34;,
</span><span class=ln>15</span><span class=s1>            &#34;redis.channels.pattern.enabled&#34;: true
</span><span class=ln>16</span><span class=s1>        }
</span><span class=ln>17</span><span class=s1>    }&#39;</span>
</code></pre></div><p>Create an interactive, ephemeral Kubernetes pod with redis-client installed:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl -n kcr-demo run -it --rm redis-client --image redis:6 -- /bin/bash
</code></pre></div><p>Use <code>redis-cli</code> in the pod to connect to the Redis cluster:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>redis-cli -c -u <span class=s1>&#39;redis://IEPfIr0eLF7UsfwrIlzy80yUaBG258j9@redis-cluster&#39;</span>
</code></pre></div><p>Run Redis commands to create some different keyspace notification events:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=ln> 1</span>SET {user.1}.username jetpackmelon22 EX 2
<span class=ln> 2</span>SET {user.2}.username anchorgoat74 EX 2
<span class=ln> 3</span>SADD {user.1}.interests reading
<span class=ln> 4</span>EXPIRE {user.1}.interests 2
<span class=ln> 5</span>SADD {user.2}.interests sailing woodworking programming
<span class=ln> 6</span>EXPIRE {user.2}.interests 2
<span class=ln> 7</span>GET {user.1}.username
<span class=ln> 8</span>GET {user.2}.username
<span class=ln> 9</span>SMEMBERS {user.1}.interests
<span class=ln>10</span>SMEMBERS {user.2}.interests
</code></pre></div><p>In another terminal, create an interactive, ephemeral Kubernetes pod to tail the Kafka topic that the connector is producing records to:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl -n kcr-demo run -it --rm kafka-tail-records --image confluentinc/cp-kafka:6.0.0 --command /bin/bash
</code></pre></div><p>Run the following command to tail the topic from the beginning:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kafka-console-consumer <span class=se>\
</span><span class=ln>2</span><span class=se></span>    --bootstrap-server kafka-broker-0.kafka-broker:9092 <span class=se>\
</span><span class=ln>3</span><span class=se></span>    --property print.key<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span><span class=ln>4</span><span class=se></span>    --property key.separator<span class=o>=</span><span class=s1>&#39;|&#39;</span> <span class=se>\
</span><span class=ln>5</span><span class=se></span>    --topic redis.events <span class=se>\
</span><span class=ln>6</span><span class=se></span>    --from-beginning
</code></pre></div><p>Give it a few seconds to catch up to the records that have already been written.</p>
<p>Switch back and forth between your <code>redis-cli</code> pod and your <code>kafka-console-consumer</code> pod to observe how interactions with Redis produce Kafka records.</p>
<h2 id=cleanup>Cleanup</h2>
<p>All good things must eventually come to an end.</p>
<p>If you want to keep using the minikube instance that you set up but want to remove all of the Kafka and Redis stuff that we installed inside it for this demo, run the following command:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>kubectl delete -k kubernetes
</code></pre></div><p>If you’re done with minikube entirely, just delete it:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>minikube delete
</code></pre></div><h2 id=closing-remarks>Closing Remarks</h2>
<p>I hope that you had a great time playing with <a href=https://github.com/jaredpetersen/kafka-connect-redis target=_blank>jaredpetersen/kafka-connect-redis</a>
. It’s available now on <a href="https://search.maven.org/search?q=g:io.github.jaredpetersen%20AND%20a:kafka-connect-redis" target=_blank>Maven Central</a>
, <a href=https://www.confluent.io/hub/jaredpetersen/kafka-connect-redis target=_blank>Confluent Hub</a>
, or you can download it directly from GitHub via the <a href=https://github.com/jaredpetersen/kafka-connect-redis/releases target=_blank>Releases</a>
page. There’s more work to be done so stay tuned!</p>
<p>If this connector brings any sort of value to your life, please consider starring the repository, sponsoring the project, or just <a href=https://twitter.com/jaredtpetersen target=_blank>tweet at me</a>
.</p>
</section>
</main>
</body>
</html>